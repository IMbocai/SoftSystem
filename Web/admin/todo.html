<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>软件设计开发跟进系统</title>
<link rel="stylesheet" href="../public/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="../public/css/reset.css">
<link rel="stylesheet" type="text/css" href="../public/css/style.css">
<link rel="stylesheet" type="text/css" href="../public/css/fullcalendar.min.css">
</head>
<body>
<!-- header -->
<header class="navbar navbar-static-top bs-docs-nav" id="top" role="banner" style="background-color:#1A86C0;margin-bottom:0;">
  <div class="container">
    <div class="navbar-header">
      <a href="../" class="navbar-brand">Logo</a>
    </div>
    <nav id="bs-navbar" class="collapse navbar-collapse">
      <ul id="nav_ul" class="nav navbar-nav">
        <li class="active">
          <a>欢迎登陆</a>
        </li>
        <li class="active">
          <a id="header_name"></a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
      	<li><a href="">消息通知</a></li>
      	<!-- <li><a href="">修改密码</a></li> -->
        <li><a id="logout" href="javascript:void(0);">退出</a></li>
      </ul>
    </nav>
  </div>
</header>
<!-- menu -->
<div class="sidebar-scroll" style="overflow: hidden; outline: none;" tabindex="5000">
	<div id="sidebar" class="nav-collapse collapse">
		<ul class="sidebar-menu">
			<li class="sub-menu">
			    <a class="" href="index.html">
			        <i class="glyphicon glyphicon-user"></i>
			        <span>成员管理</span>
			    </a>
			</li>
			<li class="sub-menu">
			    <a class="" href="product.html">
			        <i class="glyphicon glyphicon-indent-left"></i>
			        <span>产品管理</span>
			    </a>
			</li>
			<li class="sub-menu  active">
			    <a class="" href="todo.html">
			        <i class="glyphicon glyphicon-tags"></i>
			        <span>个人任务</span>
			    </a>
			</li>
			<li class="sub-menu">
			    <a class="" href="password.html">
			        <i class="glyphicon glyphicon-edit"></i>
			        <span>修改密码</span>
			    </a>
			</li>
			<li class="sub-menu">
			    <a class="" href="userInfo.html">
			        <i class="glyphicon glyphicon-send"></i>
			        <span>个人资料</span>
			    </a>
			</li>
		</ul>
	 <!-- END SIDEBAR MENU -->
	</div>
</div>
<!-- main -->
<div id="main-content">
         <div class="container-fluid">
            <div class="row-fluid">
               <div class="span12">
                   <h3 class="page-title">
                    个人任务
                   </h3>
                   <ol class="breadcrumb">
					  <li class="active">todo</li>
					</ol>
               </div>
            </div>
            <div class="row-fluid">
                <div class="span9 responsive" data-tablet="span9 fix-margin" data-desktop="span9">
                    <div class="widget yellow">
                        <div class="widget-body">
                            <div id="calendar" class="has-toolbar fc">
                            	
                            </div>
                        </div>
                    </div>
                </div>
            </div>       
         </div>
</div>
<!-- 添加任务弹窗 -->
<div class="modal fade" id="showTodo">
  <div class="modal-dialog" style="width:400px;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">新建任务</h4>
      </div>
      <div class="modal-body">
        <form action="">
        	<label for="taskName">任务名称</label>
        	<input type="text" class="form-control" id="taskName" placeholder="请输入任务名称">
        	<label for="startTime">开始时间</label>
        	<input type="date" class="form-control" id="startTime">
        	<label for="endTime">结束时间</label>
        	<input type="date" class="form-control" id="endTime" >
        	<label for="taskLevel">优先级</label>
        	<select id="taskLevel" class="form-control selLevel" autocomplete="off">                        
        		<option value="0">低</option>                        
        		<option value="1">中</option>                        
        		<option value="2">高</option>                        
        		<option value="3">紧急</option>                    
        	</select>
        	<label for="taskStatus">任务状态</label>
        	<select id="taskStatus" class="form-control" autocomplete="off">                        
        		<option value="0">进行中</option>                        
        		<option value="1">已完成</option>                      
        	</select>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-success" id="addTask">创建</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>
<!-- 编辑任务弹窗 -->
<div class="modal fade" id="editTodo">
  <div class="modal-dialog" style="width:400px;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">编辑(查看)任务</h4>
      </div>
      <div class="modal-body">
        <form action="" id="editForm" data-value="">
        	<label for="edit_taskName">任务名称</label>
        	<input type="text" class="form-control" id="edit_taskName">
        	<label for="edit_startTime">开始时间</label>
        	<input type="date" class="form-control" id="edit_startTime">
        	<label for="edit_endTime">结束时间</label>
        	<input type="date" class="form-control" id="edit_endTime" >
        	<label for="edit_taskLevel">优先级</label>
        	<select id="edit_taskLevel" class="form-control selLevel">                        
        		<option value="0">低</option>                        
        		<option value="1">中</option>                        
        		<option value="2">高</option>                        
        		<option value="3">紧急</option>                    
        	</select>
        	<label for="edit_taskStatus">任务状态</label>
        	<select id="edit_taskStatus" class="form-control" autocomplete="off">                        
        		<option value="0">进行中</option>                        
        		<option value="1">已完成</option>                      
        	</select>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-danger" id="delTask">删除</button>
        <button type="button" class="btn btn-success" id="sureTask">保存</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>
<div id="footer">
       2016 © shixubo-3112006441.
</div>
<script type="text/javascript" src="../public/js/jquery-1.11.1.min.js"></script>
<script src="../public/bootstrap/js/bootstrap.min.js"></script>
<script src="../public/js/jquery.nicescroll.min.js"></script>
<script src="../public/js/fullcalendar.min.js"></script>
<script src="../public/js/logout.js"></script>
<script>
	$(document).ready(function(){
		$("#main-content").niceScroll({
			cursorcolor:"#1A86C0",
			cursorwidth: "10px"
		});
		var params;//存储任务信息
		//获取用户拥有的任务
		$('#calendar').fullCalendar({
			events:'/home/index.php/Task/showTask',
			eventClick: function(calEvent, jsEvent, view) {
	            var s_Date = $.fullCalendar.formatDate(calEvent.start,'yyyy-MM-dd');
	            var e_Date = "";
	            if(calEvent.end){
	                e_Date = $.fullCalendar.formatDate(calEvent.end,'yyyy-MM-dd');
	            }
	            params = {
	                "id":calEvent.taskId,
	                "title" :calEvent.title,
	                "startdate":s_Date,
	                "enddate":e_Date,
	                "taskLevel":calEvent.taskLevel,
	                "taskStatus":calEvent.taskStatus
	            };
	        }
		});
		//点击日期添加事件
		$(".fc-day").each(function(){
			$(this).attr("data-toggle","modal");
			$(this).attr("data-target","#showTodo")
		});
		$("#calendar").on("click",".fc-day",function(){
			var date = $(this).attr("data-date");
			$("#startTime").val(date);
			$("#endTime").val(date);
		});
		//查看任务editTodo
		setTimeout(function(){
			$(".fc-event-inner").each(function(){
				$(this).attr("data-toggle","modal");
				$(this).attr("data-target","#editTodo")
			});
		},100);
		$("#calendar").on("click",".fc-event-inner",function(){
			console.log(params);
			$("#editForm").attr("data-value",params.id);
			$("#edit_taskName").val(params.title);
			$("#edit_startTime").val(params.startdate);
			params.enddate == "" ? $("#edit_endTime").val(params.startdate) : $("#edit_endTime").val(params.enddate);
			$("#edit_taskLevel").val(params.taskLevel);
			$("#edit_taskStatus").val(params.taskStatus);
		});
		//删除任务
		$("#delTask").on("click",function(){
			var taskId = $("#editForm").attr("data-value");
			$.post("/home/index.php/Task/delTask",{//删除任务接口
				taskId:taskId
			},function(result){
				console.log(result);
				if(result.status == 1){
					window.location.reload();
				}else{
					alert("任务编辑失败，请重试");
					return false;
				}
			});
		});
		//编辑任务
		$("#sureTask").on("click",function(){
			var taskId = $("#editForm").attr("data-value");
			var taskName = $("#edit_taskName").val(),
				startTime = $("#edit_startTime").val(),
				endTime = $("#edit_endTime").val(),
				taskLevel = $("#edit_taskLevel").val(),
				taskStatus = $("#edit_taskStatus").val();
			$.post("/home/index.php/Task/editTask",{//编辑任务接口
				taskId:taskId,
				taskName:taskName,
				startTime:startTime,
				endTime:endTime,
				taskLevel:taskLevel,
				taskStatus:taskStatus
			},function(result){
				console.log(result);
				if(result.status == 1){
					alert("任务编辑成功");
					window.location.reload();
				}else{
					alert("任务编辑失败，请重试");
					return false;
				}
			});
		});
		//添加任务
		$("#addTask").on("click",function(){
			var taskName = $("#taskName").val(),
				startTime = $("#startTime").val(),
				endTime = $("#endTime").val(),
				taskLevel = $("#taskLevel").val(),
				taskStatus = $("#taskStatus").val();
			if(!taskName || !startTime || !endTime || !taskLevel || !taskStatus){
				alert("请填写信息完整");
				return false;
			}else{
				$.post("/home/index.php/Task/addTask",{//添加任务接口
					taskName:taskName,
					startTime:startTime,
					endTime:endTime,
					taskLevel:taskLevel,
					taskStatus:taskStatus
				},function(result){
					if(result.status == 1){
						alert("任务创建成功");
						window.location.reload();
					}else{
						alert("任务创建失败，请重试");
						return false;
					}
				});
			}
		});
	})

</script>
</body>
</html>